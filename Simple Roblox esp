local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- Function to create ESP box outline
local function createESPBox(character)
    local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
    local espBox = Instance.new("BoxHandleAdornment") -- Create a Box Handle Adornment for the outline

    espBox.Size = Vector3.new(4, 6, 2) -- Size of the outline box around the player
    espBox.Color3 = Color3.new(0, 0, 1) -- Blue color
    espBox.Transparency = 0.5 -- Semi-transparent
    espBox.AlwaysOnTop = true
    espBox.ZIndex = 10
    espBox.Adornee = humanoidRootPart
    espBox.Parent = humanoidRootPart -- Attach it to the HumanoidRootPart

    -- Adjust the box's position to be centered on the player
    runService.RenderStepped:Connect(function()
        if character and character:FindFirstChild("HumanoidRootPart") then
            espBox.Adornee = humanoidRootPart
        else
            espBox:Destroy() -- Destroy if character disappears
        end
    end)

    return espBox
end

-- Function to set up ESP for the player
local function setupESPForPlayer(player)
    player.CharacterAdded:Connect(function(character)
        createESPBox(character)
    end)

    -- If the character already exists, create the ESP box
    if player.Character then
        createESPBox(player.Character)
    end
end

-- Initialize ESP for all current players
for _, player in ipairs(Players:GetPlayers()) do
    setupESPForPlayer(player)
end

-- Handle new players joining the game
Players.PlayerAdded:Connect(setupESPForPlayer)
