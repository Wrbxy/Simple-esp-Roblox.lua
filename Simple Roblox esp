local Players = game:GetService("Players")

local blueColor = Color3.fromRGB(0, 0, 255)

local function createESP(player)
    -- Create ESP for player's character
    local function onCharacterAdded(character)
        local humanoidRootPart = character:WaitForChild("HumanoidRootPart", 5)
        if not humanoidRootPart then return end  -- Exit if the root part is not found

        -- Create the BillboardGui for ESP
        local esp = Instance.new("BillboardGui")
        esp.Parent = humanoidRootPart
        esp.Size = UDim2.new(3, 0, 3, 0)
        esp.AlwaysOnTop = true

        -- Create a Frame to act as the outline
        local frame = Instance.new("Frame")
        frame.Parent = esp
        frame.Size = UDim2.new(1, 0, 1, 0)
        frame.BackgroundColor3 = blueColor
        frame.BorderSizePixel = 0
        frame.Transparency = 0.5 -- Set transparency for the outline effect

        -- Clean up ESP when character is removed
        character.AncestryChanged:Connect(function(_, newParent)
            if not newParent then
                esp:Destroy() -- Remove ESP when the character is removed
            end
        end)
    end

    -- Connect the CharacterAdded event
    player.CharacterAdded:Connect(onCharacterAdded)

    -- Apply ESP if the character already exists (this handles respawns)
    if player.Character then
        onCharacterAdded(player.Character)
    end
end

-- Apply ESP to all existing players when the script runs
for _, player in ipairs(Players:GetPlayers()) do
    createESP(player)
end

-- Apply ESP to new players joining
Players.PlayerAdded:Connect(createESP)
